<div class="flex flex-col gap-6">
  <h1 class="text-3xl font-semibold text-surface-900 dark:text-surface-0">
    Overview
  </h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <p-card class="h-full">
        <div class="flex flex-col gap-2 ">
          <div
            class="text-lg  font-medium text-surface-600 dark:text-surface-300"
          >
            Total Attendance
          </div>
          <div
            id="attendance"
            class="text-3xl font-bold text-surface-900 dark:text-surface-0"
          >
            {{ displayedAttendance | number : "1.2-2" }}%
          </div>
          <!-- <div class="text-sm text-green-500">+2% from last week</div> -->
        </div>
      </p-card>
    </div>

    <div>
      <p-card>
        <div class="flex flex-col gap-2">
          <div
            class="text-lg font-medium text-surface-600 dark:text-surface-300"
          >
            Overall Marks
          </div>
          <div class="text-3xl font-bold text-surface-900 dark:text-surface-0">
            {{ obtainedMarks }}/{{ totalMarks }}
          </div>
          <div class="text-sm text-surface-500">Based on internals</div>
        </div>
      </p-card>
    </div>
  </div>
  <div class="flex flex-row gap-2 overflow-x-auto scrollbar-hide">
      <p-chip class="!py-0 !pl-0 !pr-4" >
        <span
          class="bg-primary border-amber-400 border-1 text-primary-contrast rounded-full w-8 h-8 flex items-center justify-center"
        >
          {{ getLowestAttendanceCourses()[0].courseAttendance | number : '1.0-0' : ''}}
        </span>
        <span class="ml-2 font-medium w-max"> {{getLowestAttendanceCourses()[0].courseTitle}} </span>
      </p-chip>
      <p-chip class="!py-0 !pl-0 !pr-4">
        <span
          class="bg-primary border-amber-400 border-1 text-primary-contrast rounded-full w-8 h-8 flex items-center justify-center"
        >
          {{getLowestAttendanceCourses()[1].courseAttendance | number : '1.0-0' : ''}}
        </span>
        <span class="ml-2 font-medium w-max"> {{getLowestAttendanceCourses()[1].courseTitle}} </span>
      </p-chip>
      <p-chip class="!py-0 !pl-0 !pr-4">
        <span
          class="bg-primary border-amber-400 border-1 text-primary-contrast rounded-full w-8 h-8 flex items-center justify-center"
        >
          {{getLowestAttendanceCourses()[2].courseAttendance | number : '1.0-0' : ''}}
        </span>
        <span class="ml-2 font-medium w-max"> {{getLowestAttendanceCourses()[2].courseTitle}} </span>
      </p-chip>
    </div>
  <p-divider type="solid" />
</div>
<div class="mt-8">
  <div class="flex justify-between items-center mb-4">
    @if(timetable.length > 0) {
    <h2 class="text-2xl font-semibold text-surface-900 dark:text-surface-0">
      Timetable - {{ timetable[currentDayIndex].dayOrder }}
    </h2>
    }
    <div class="flex gap-2">
      <p-button
        icon="pi pi-arrow-left"
        [disabled]="currentDayIndex === 0"
        (click)="previousDay()"
        styleClass="p-button-outlined"
      ></p-button>
      <p-button
        icon="pi pi-arrow-right"
        [disabled]="currentDayIndex === timetable.length - 1"
        (click)="nextDay()"
        styleClass="p-button-outlined"
      ></p-button>
    </div>
  </div>

  @if(timetable.length > 0) {
  <p-table
    [value]="timetable[currentDayIndex].classes"
    styleClass="p-datatable-striped"
  >
    <ng-template pTemplate="header">
      <tr>
        <th class="text-center">Time</th>
        <th class="text-center">Course Title</th>
        <th class="text-center">Attendance</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-class>
      <tr [ngClass]="{ 'bg-primary-50 dark:bg-primary-900/50': class.isClass }">
        <td class="text-center">{{ class.time }}</td>
        <td class="text-center">
          {{ class.isClass ? class.courseTitle : "---" }}
        </td>
        <td
          class="text-center"
          [ngClass]="getAttendanceClass(class.courseCode)"
        >
          @if(class.isClass) {
          <div class="flex items-center justify-center">
            <span class="font-semibold">{{
              getAttendanceForCourse(class.courseCode)
            }}</span>
            @let change = getAttendanceChange(class.courseCode); @if(change) {
            <span class="ml-2 text-xs text-surface-400 font-normal">
              (<span class="text-green-500">+{{ change.increase }}%</span>
              /
              <span class="text-red-500">-{{ change.decrease }}%</span>)
            </span>
            }
          </div>
          } @else { --- }
        </td>
      </tr>
    </ng-template>
  </p-table>
  } @else {
  <p>Loading timetable...</p>
  }
</div>
